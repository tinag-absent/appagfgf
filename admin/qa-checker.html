<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>コンテンツQAチェッカー — 海蝕機関</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#07090f;--panel:#0c1018;--panel2:#111620;--border:#1a2030;--border2:#263040;
  --cyan:#00d4ff;--cyan-dim:#002838;--green:#00e676;--green-dim:#002810;
  --yellow:#ffd740;--yellow-dim:#2a2000;--red:#ff5252;--red-dim:#2a0808;
  --purple:#ce93d8;--orange:#ff9800;
  --text:#cdd6e8;--text2:#7a8aa0;--text3:#445060;
  --mono:'Share Tech Mono',monospace;--sans:'Noto Sans JP',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);font-size:13px;min-height:100vh;display:flex;flex-direction:column;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,212,255,.01) 3px,rgba(0,212,255,.01) 4px);}
.hdr{background:var(--panel);border-bottom:1px solid var(--border2);padding:0 24px;height:50px;display:flex;align-items:center;gap:14px;position:sticky;top:0;z-index:100;flex-shrink:0;}
.hdr-dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.hdr-title{font-family:var(--mono);font-size:12px;color:var(--green);letter-spacing:.2em;}
.hdr-sub{font-family:var(--mono);font-size:10px;color:var(--text3);}
.hdr-sep{flex:1;}

.layout{display:flex;flex:1;}

/* Control panel */
.ctrl{width:280px;background:var(--panel);border-right:1px solid var(--border);padding:20px;display:flex;flex-direction:column;gap:20px;flex-shrink:0;overflow-y:auto;}
.ctrl-section{}
.ctrl-title{font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:.15em;text-transform:uppercase;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid var(--border);}

/* Level selector */
.level-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
.lv-btn{background:none;border:1px solid var(--border2);color:var(--text3);font-family:var(--mono);font-size:11px;padding:8px 4px;cursor:pointer;transition:all .15s;text-align:center;}
.lv-btn:hover{border-color:var(--cyan);color:var(--cyan);}
.lv-btn.active{border-color:var(--cyan);color:var(--cyan);background:var(--cyan-dim);}

/* Division selector */
.div-select{width:100%;background:var(--panel2);border:1px solid var(--border2);color:var(--text);padding:8px 10px;font-family:var(--sans);font-size:12px;outline:none;cursor:pointer;}
.div-select:focus{border-color:var(--cyan);}

/* Flag toggles */
.flag-list{display:flex;flex-direction:column;gap:4px;}
.flag-toggle{display:flex;align-items:center;gap:8px;padding:6px 8px;cursor:pointer;border:1px solid var(--border);transition:all .15s;}
.flag-toggle:hover{border-color:var(--border2);}
.flag-toggle.on{background:var(--green-dim);border-color:var(--green);}
.flag-name{font-family:var(--mono);font-size:10px;color:var(--text2);flex:1;}
.flag-toggle.on .flag-name{color:var(--green);}
.flag-indicator{width:6px;height:6px;border-radius:50%;background:var(--border2);flex-shrink:0;}
.flag-toggle.on .flag-indicator{background:var(--green);box-shadow:0 0 4px var(--green);}

/* Variable sliders */
.var-row{margin-bottom:10px;}
.var-label{display:flex;justify-content:space-between;margin-bottom:4px;}
.var-name-lbl{font-family:var(--mono);font-size:10px;color:var(--text3);}
.var-val-lbl{font-family:var(--mono);font-size:10px;color:var(--yellow);}
.var-slider{width:100%;appearance:none;height:4px;background:var(--border2);outline:none;}
.var-slider::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:var(--yellow);cursor:pointer;border:2px solid var(--bg);box-shadow:0 0 4px var(--yellow);}

/* Simulate btn */
.sim-btn{background:var(--green-dim);border:1px solid var(--green);color:var(--green);font-family:var(--mono);font-size:11px;padding:10px;cursor:pointer;letter-spacing:.1em;width:100%;transition:background .15s;}
.sim-btn:hover{background:#004020;}

/* Preview pane */
.preview{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:20px;}

/* Preview section card */
.pv-card{background:var(--panel);border:1px solid var(--border);}
.pv-card-head{padding:10px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.pv-card-icon{font-family:var(--mono);font-size:11px;color:var(--cyan);}
.pv-card-title{font-family:var(--mono);font-size:11px;color:var(--text2);letter-spacing:.08em;}
.pv-card-status{margin-left:auto;font-family:var(--mono);font-size:10px;padding:2px 8px;border-radius:2px;}
.pv-card-body{padding:16px;}

/* Access table */
.access-table{width:100%;border-collapse:collapse;}
.access-table th{text-align:left;padding:6px 12px;font-family:var(--mono);font-size:9px;color:var(--text3);letter-spacing:.1em;border-bottom:1px solid var(--border);}
.access-table td{padding:7px 12px;border-bottom:1px solid var(--border);font-size:12px;}
.access-table tr:last-child td{border-bottom:none;}
.access-chip{font-family:var(--mono);font-size:9px;padding:2px 8px;border-radius:2px;}

/* XP bar preview */
.xp-preview{background:var(--panel2);padding:14px;border:1px solid var(--border);}
.xp-header{display:flex;justify-content:space-between;margin-bottom:6px;}
.xp-lv{font-family:var(--mono);font-size:13px;}
.xp-val{font-family:var(--mono);font-size:11px;color:var(--text2);}
.xp-bar{height:6px;background:var(--border2);margin-bottom:4px;}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--cyan),#0080ff);transition:width .4s;}
.xp-next{font-family:var(--mono);font-size:10px;color:var(--text3);}

/* Message preview */
.msg-preview{background:var(--panel2);border:1px solid var(--border2);padding:14px;margin-bottom:8px;}
.msg-key{font-family:var(--mono);font-size:9px;color:var(--text3);margin-bottom:6px;letter-spacing:.1em;}
.msg-val{font-size:13px;line-height:1.6;}
.msg-val.en{font-family:var(--mono);font-size:11px;color:var(--cyan);}

/* Story phase */
.phase-indicator{display:flex;gap:8px;flex-wrap:wrap;}
.phase-chip{font-family:var(--mono);font-size:10px;padding:4px 10px;border-radius:2px;border:1px solid;}

/* Toast */
.toast{position:fixed;bottom:20px;right:20px;background:var(--panel);border:1px solid var(--green);color:var(--green);font-family:var(--mono);font-size:11px;padding:10px 16px;opacity:0;transform:translateY(8px);transition:all .25s;pointer-events:none;z-index:9998;}
.toast.show{opacity:1;transform:translateY(0);}

::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--border2);}

.empty-hint{padding:40px;text-align:center;color:var(--text3);font-family:var(--mono);font-size:11px;}
</style>
</head>
<body>
<div class="hdr">
  <div class="hdr-dot"></div>
  <div class="hdr-title">KAISHOKU // QA CHECKER</div>
  <div class="hdr-sub">コンテンツプレビュー / QAチェッカー</div>
  <div class="hdr-sep"></div>
  <span style="font-family:var(--mono);font-size:10px;color:var(--text3)" id="simLabel">シミュレーション設定を変更してプレビューを確認</span>
</div>

<div class="layout">
  <!-- Controls -->
  <div class="ctrl">
    <div class="ctrl-section">
      <div class="ctrl-title">プレイヤーレベル</div>
      <div class="level-grid">
        <button class="lv-btn" onclick="setLevel(0,this)">LV0</button>
        <button class="lv-btn active" onclick="setLevel(1,this)">LV1</button>
        <button class="lv-btn" onclick="setLevel(2,this)">LV2</button>
        <button class="lv-btn" onclick="setLevel(3,this)">LV3</button>
        <button class="lv-btn" onclick="setLevel(4,this)">LV4</button>
        <button class="lv-btn" onclick="setLevel(5,this)">LV5</button>
      </div>
    </div>

    <div class="ctrl-section">
      <div class="ctrl-title">XP (累計)</div>
      <div class="var-row">
        <div class="var-label"><span class="var-name-lbl">experience points</span><span class="var-val-lbl" id="xpVal">100</span></div>
        <input type="range" class="var-slider" id="xpSlider" min="0" max="2500" value="100" oninput="syncXp(this.value)">
      </div>
    </div>

    <div class="ctrl-section">
      <div class="ctrl-title">所属部門</div>
      <select class="div-select" id="divSelect" onchange="render()">
        <option>収束部門</option>
        <option>支援部門</option>
        <option>工作部門</option>
        <option>外事部門</option>
        <option>港湾部門</option>
      </select>
    </div>

    <div class="ctrl-section">
      <div class="ctrl-title">ストーリーフラグ</div>
      <div class="flag-list" id="flagList"></div>
    </div>

    <div class="ctrl-section">
      <div class="ctrl-title">内部変数</div>
      <div class="var-row">
        <div class="var-label"><span class="var-name-lbl">anomaly_score</span><span class="var-val-lbl" id="anomalyVal">0</span></div>
        <input type="range" class="var-slider" id="anomalySlider" min="0" max="60" value="0" oninput="setVar('anomaly',this.value)">
      </div>
      <div class="var-row">
        <div class="var-label"><span class="var-name-lbl">observer_load</span><span class="var-val-lbl" id="observerVal">0</span></div>
        <input type="range" class="var-slider" id="observerSlider" min="0" max="100" value="0" oninput="setVar('observer',this.value)">
      </div>
    </div>

    <button class="sim-btn" onclick="render()">▶ プレビューを更新</button>
  </div>

  <!-- Preview -->
  <div class="preview" id="preview">
    <div class="empty-hint">左のコントロールでシミュレーション条件を設定し「プレビューを更新」を押してください</div>
  </div>
</div>

<div class="toast" id="toastEl"></div>

<script>
const CONFIG = {"levelThresholds": {"0": 0, "1": 100, "2": 250, "3": 500, "4": 1000, "5": 2000}, "levelUnlocks": {"0": ["index.html", "login.html", "dashboard.html"], "1": ["divisions.html", "chat.html", "map.html", "details/location-detail.html", "history.html"], "2": ["division-convergence.html", "division-support.html", "division-engineering.html", "division-foreign.html", "division-port.html", "details/entity-detail.html", "details/module-detail.html", "entities.html", "modules.html"], "3": ["phenomenon.html"], "4": ["missions.html", "search.html", "details/mission-detail.html"], "5": ["classified.html", "details/personnel-detail.html"]}, "xpRewards": {"first_login": 50, "profile_view": 10, "chat_message": 5, "division_view": 20, "phenomenon_view": 30, "mission_complete": 100, "daily_login": 25}, "dailyLoginRewards": {"1": 25, "2": 30, "3": 35, "4": 40, "5": 45, "6": 50, "7": 100}};
const MSGS = {"rankTitles": {"0": {"title": "見習い機関員", "titleEn": "TRAINEE AGENT", "color": "#6b7280", "colorNote": "グレー", "status": "研修中"}, "1": {"title": "初級機関員", "titleEn": "JUNIOR AGENT", "color": "#3b82f6", "colorNote": "ブルー", "status": "任務遂行中"}, "2": {"title": "中級機関員", "titleEn": "AGENT", "color": "#8b5cf6", "colorNote": "パープル", "status": "任務遂行中"}, "3": {"title": "上級機関員", "titleEn": "SENIOR AGENT", "color": "#10b981", "colorNote": "グリーン", "status": "重要任務担当"}, "4": {"title": "ベテラン機関員", "titleEn": "VETERAN AGENT", "color": "#f59e0b", "colorNote": "オレンジ", "status": "特殊任務担当"}, "5": {"title": "エリート機関員", "titleEn": "ELITE AGENT", "color": "#ef4444", "colorNote": "レッド", "status": "最高機密任務担当"}}, "welcomeMessages": {"0": ["海蝕機関へようこそ。まずは基礎訓練から始めましょう。", "機関員としての第一歩です。システムに慣れてください。", "研修期間中です。各部門の情報を確認してください。"], "1": {"title": "初級機関員として認定されました", "message": "基礎訓練を修了し、実務への参加が許可されました。各部門の活動に参加し、経験を積んでください。"}, "2": {"title": "中級機関員に昇格", "message": "実務経験を評価され、より重要な任務へのアクセスが許可されました。収束装置の運用にも精通してきています。"}, "3": {"title": "上級機関員として承認", "message": "高度な専門知識と実績が認められました。海蝕現象に関する機密情報へのアクセスが可能になります。"}, "4": {"title": "ベテラン機関員の地位を獲得", "message": "豊富な経験と卓越した能力により、特殊任務の遂行が認められました。機関の中核を担う存在です。"}, "5": {"title": "エリート機関員として最高位に到達", "message": "最高レベルのクリアランスを取得しました。機関の最も重要な機密にアクセスできる、限られた存在の一人です。"}}, "statusMessages": {"0": {"main": "基礎研修を受講中", "sub": "レベル1で実務への参加が可能になります"}, "1": {"main": "各部門の情報にアクセス可能", "sub": "より多くの機能を解除するために経験を積みましょう"}, "2": {"main": "部門詳細情報へのアクセス許可", "sub": "収束装置の運用実績を積んでいます"}, "3": {"main": "海蝕現象アーカイブへのアクセス許可", "sub": "高度な機密情報の閲覧が可能です"}, "4": {"main": "収束案件データベースへのアクセス許可", "sub": "特殊任務の遂行権限を持っています"}, "5": {"main": "全システムへのフルアクセス許可", "sub": "機関の最高機密情報へアクセス可能です"}}, "dashboardMessages": {"0": {"greeting": "ようこそ、研修生", "description": "これからあなたは海蝕機関の一員として、現実の歪みと戦うことになります。まずは各部門の情報を確認し、システムに慣れてください。"}, "1": {"greeting": "お疲れ様です、初級機関員", "description": "基礎訓練を完了し、実務への参加が認められました。各部門と連携しながら、海蝕現象の収束に貢献してください。"}, "2": {"greeting": "お帰りなさい、機関員", "description": "実績を評価され、中級機関員として承認されました。より重要な任務に参加し、収束技術の習得を進めてください。"}, "3": {"greeting": "お疲れ様です、上級機関員", "description": "豊富な経験と専門知識により、機密情報へのアクセスが許可されました。海蝕現象の本質に迫る研究に参加できます。"}, "4": {"greeting": "ようこそ、ベテラン機関員", "description": "特殊任務の遂行が認められた、機関の中核メンバーです。あなたの経験と判断が、多くの収束活動を成功に導いています。"}, "5": {"greeting": "お帰りなさい、エリート機関員", "description": "最高位のクリアランスを持つ、機関の精鋭です。すべての機密情報へアクセスでき、最重要任務の指揮を執ることができます。"}}, "dailyLoginMessages": {"0": {"title": "研修日誌を記録", "description": "日々の学習記録が蓄積されています"}, "1": {"title": "活動記録を更新", "description": "実務への参加が記録されました"}, "2": {"title": "任務報告を提出", "description": "継続的な活動が評価されています"}, "3": {"title": "機密アクセスログを記録", "description": "重要情報への定期的なアクセスを確認"}, "4": {"title": "特殊任務ログを更新", "description": "ベテラン機関員としての活動を記録"}, "5": {"title": "エリート機関員の活動を記録", "description": "最高機密レベルのアクセスログ"}}, "hintMessages": {"0": ["チャット機能で他の機関員と交流し、経験値を獲得できます", "各部門の情報を閲覧すると経験値が得られます", "毎日ログインすることで、着実に成長できます"], "1": ["部門詳細ページを閲覧して、より深い知識を得ましょう", "継続的なログインでストリークボーナスを獲得できます", "レベル2で各部門の詳細情報にアクセスできます"], "2": ["海蝕現象アーカイブへのアクセスまであと少しです", "定期的なアクティビティで経験値を獲得しましょう", "上級機関員を目指して活動を続けてください"], "3": ["収束案件データベースへのアクセスが間もなく可能になります", "あなたは機関の重要なメンバーです", "ベテラン機関員まであと一歩です"], "4": ["最高レベルまであと少しです", "エリート機関員への道が開かれつつあります", "あなたの経験と知識は機関にとって貴重です"], "5": ["すべてのコンテンツにアクセス可能です", "最高レベルに到達しました。おめでとうございます", "機関の精鋭として、引き続き活躍してください"]}, "levelUpMessages": {"1": {"title": "初級機関員に昇格", "message": "おめでとうございます。実務への参加が許可されました。", "unlocked": "各部門情報、機関員チャット"}, "2": {"title": "中級機関員に昇格", "message": "あなたの実績が認められました。より重要な任務に参加できます。", "unlocked": "各部門の詳細情報"}, "3": {"title": "上級機関員に昇格", "message": "高度な専門知識が評価されました。機密情報へのアクセスが許可されます。", "unlocked": "海蝕現象アーカイブ"}, "4": {"title": "ベテラン機関員に昇格", "message": "卓越した能力により、特殊任務の遂行が認められました。", "unlocked": "収束案件データベース"}, "5": {"title": "エリート機関員に到達", "message": "最高位のクリアランスを取得しました。機関の精鋭です。", "unlocked": "機密文書アーカイブ、全システムへのフルアクセス"}}, "motivationalMessages": {"0": ["一歩ずつ、着実に前進しましょう", "学ぶことは多いですが、焦らず進んでください", "あなたの成長を期待しています"], "1": ["順調に成長しています", "実務経験を積んで、さらなる高みを目指しましょう", "あなたの活動が機関を支えています"], "2": ["中級機関員として順調です", "専門性を高めて上級を目指しましょう", "あなたの貢献に感謝します"], "3": ["上級機関員としての実力を発揮しています", "機関の重要な戦力です", "あなたの知識が多くの任務を成功に導いています"], "4": ["ベテランとして頼もしい存在です", "最高レベルまであと一歩です", "あなたの経験は機関の財産です"], "5": ["エリート機関員として完璧です", "最高のパフォーマンスを維持しています", "機関の精鋭として、素晴らしい活躍です"]}};

const LEVEL_COLORS = ['#6b7280','#3b82f6','#8b5cf6','#10b981','#f59e0b','#ef4444'];
const LEVEL_TITLES = ['見習い機関員','初級機関員','中級機関員','上級機関員','ベテラン機関員','エリート機関員'];
const LEVEL_TITLES_EN = ['TRAINEE AGENT','JUNIOR AGENT','AGENT','SENIOR AGENT','VETERAN AGENT','ELITE AGENT'];

const PAGES_BY_LEVEL = {
  0: ['トップページ','ログイン','ダッシュボード'],
  1: ['部門一覧','チャット','マップ','ロケーション詳細','閲覧履歴'],
  2: ['各部門詳細','実体カタログ','モジュールカタログ'],
  3: ['海蝕現象DB'],
  4: ['ミッション一覧','全文検索','ミッション詳細'],
  5: ['機密文書 [CLASSIFIED]','職員詳細'],
};

const STORY_FLAGS = [
  'chapter1_open','chapter2_open','researcher_path_unlocked',
  'paranoia_path_unlocked','deep_anomaly','world_collapse','true_ending_reached','paranoia_active',
];

const STORY_PHASES = [
  { flags: [], threshold: 0, label: '通常フェーズ', color: '#7a8aa0' },
  { flags: ['chapter1_open'], threshold: 10, label: 'チャプター1解放', color: '#3b82f6' },
  { flags: ['chapter2_open'], threshold: 20, label: 'チャプター2解放', color: '#8b5cf6' },
  { flags: ['researcher_path_unlocked'], threshold: 0, label: '研究者ルート', color: '#10b981' },
  { flags: ['paranoia_path_unlocked'], threshold: 0, label: '妄想ルート', color: '#f59e0b' },
  { flags: ['world_collapse'], threshold: 50, label: '世界崩壊エンド', color: '#ef4444' },
  { flags: ['true_ending_reached'], threshold: 0, label: '真エンド', color: '#ffd740' },
];

let state = {
  level: 1, xp: 100, division: '収束部門',
  flags: {}, anomaly: 0, observer: 0
};

function renderFlagList() {
  const el = document.getElementById('flagList');
  el.innerHTML = STORY_FLAGS.map(f => `
    <div class="flag-toggle ${state.flags[f]?'on':''}" onclick="toggleFlag('${f}')">
      <div class="flag-indicator"></div>
      <div class="flag-name">${f}</div>
    </div>`).join('');
}

function toggleFlag(f) {
  state.flags[f] = !state.flags[f];
  renderFlagList();
  render();
}

function setLevel(lv, btn) {
  state.level = lv;
  document.querySelectorAll('.lv-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  // Auto-set reasonable XP
  const xp = CONFIG.levelThresholds[lv] || 0;
  state.xp = xp + 10;
  document.getElementById('xpSlider').value = state.xp;
  document.getElementById('xpVal').textContent = state.xp;
  render();
}

function syncXp(val) {
  state.xp = parseInt(val);
  document.getElementById('xpVal').textContent = val;
  // Compute level
  let lv = 0;
  for (let l=5;l>=0;l--) { if (state.xp >= CONFIG.levelThresholds[l]) { lv=l; break; } }
  state.level = lv;
  document.querySelectorAll('.lv-btn').forEach((b,i)=>b.classList.toggle('active',i===lv));
  render();
}

function setVar(key, val) {
  if (key==='anomaly') { state.anomaly=parseInt(val); document.getElementById('anomalyVal').textContent=val; }
  if (key==='observer') { state.observer=parseInt(val); document.getElementById('observerVal').textContent=val; }
  render();
}

function render() {
  state.division = document.getElementById('divSelect').value;
  const lv = state.level;
  const color = LEVEL_COLORS[lv];
  const title = LEVEL_TITLES[lv];
  const titleEn = LEVEL_TITLES_EN[lv];
  const msgs = MSGS;
  const xp = state.xp;
  const nextXp = CONFIG.levelThresholds[lv+1];
  const prevXp = CONFIG.levelThresholds[lv] || 0;
  const pct = nextXp ? Math.min(100, ((xp-prevXp)/(nextXp-prevXp))*100) : 100;

  // Compute unlocked pages
  const unlocked = [];
  for (let l=0;l<=lv;l++) {
    (CONFIG.levelUnlocks[l]||[]).forEach(p=>unlocked.push({page:p,requiredLevel:l}));
  }
  const locked = [];
  for (let l=lv+1;l<=5;l++) {
    (CONFIG.levelUnlocks[l]||[]).forEach(p=>locked.push({page:p,requiredLevel:l}));
  }

  // Story phase
  const activePhase = STORY_PHASES.filter(p => {
    const flagsOk = p.flags.every(f=>state.flags[f]);
    const thrOk = state.anomaly >= p.threshold;
    return flagsOk && thrOk;
  });

  document.getElementById('simLabel').textContent = `LV${lv} — ${title} / anomaly:${state.anomaly} / flags:${Object.values(state.flags).filter(Boolean).length}ON`;

  const preview = document.getElementById('preview');
  preview.innerHTML = [

  // ── 1. プロフィール状態 ──
  `<div class="pv-card">
    <div class="pv-card-head">
      <div class="pv-card-icon">▸</div>
      <div class="pv-card-title">プロフィール / ランク表示</div>
      <div class="pv-card-status" style="background:${color}22;color:${color};border:1px solid ${color}">LV${lv}</div>
    </div>
    <div class="pv-card-body">
      <div style="display:flex;gap:16px;align-items:center;margin-bottom:16px">
        <div style="width:60px;height:60px;background:${color}22;border:1px solid ${color}44;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:18px;color:${color}">机</div>
        <div>
          <div style="font-size:18px;font-weight:500;color:${color}">${titleEn}</div>
          <div style="font-size:14px;margin-top:2px">${title}</div>
          <div style="font-family:var(--mono);font-size:10px;color:var(--text3);margin-top:4px">${state.division}</div>
        </div>
      </div>
      <div class="xp-preview">
        <div class="xp-header"><span class="xp-lv" style="color:${color}">LEVEL ${lv}</span><span class="xp-val">${xp.toLocaleString()} XP</span></div>
        <div class="xp-bar"><div class="xp-fill" style="width:${pct}%"></div></div>
        <div class="xp-next">${nextXp?'次のレベルまで '+(nextXp-xp).toLocaleString()+' XP':'最大レベル到達'}</div>
      </div>
    </div>
  </div>`,

  // ── 2. ページアクセス権限 ──
  `<div class="pv-card">
    <div class="pv-card-head">
      <div class="pv-card-icon">▸</div>
      <div class="pv-card-title">ページアクセス権限</div>
      <div class="pv-card-status" style="background:var(--green-dim);color:var(--green);border:1px solid var(--green)">${unlocked.length}ページ解放</div>
    </div>
    <div class="pv-card-body">
      <div style="margin-bottom:10px">
        <div style="font-family:var(--mono);font-size:9px;color:var(--green);letter-spacing:.1em;margin-bottom:6px">✓ アクセス可能</div>
        <div style="display:flex;flex-wrap:wrap;gap:5px">
          ${unlocked.map(u=>`<span class="access-chip" style="background:${LEVEL_COLORS[u.requiredLevel]}18;color:${LEVEL_COLORS[u.requiredLevel]};border:1px solid ${LEVEL_COLORS[u.requiredLevel]}44">${u.page}</span>`).join('')}
        </div>
      </div>
      ${locked.length?`<div>
        <div style="font-family:var(--mono);font-size:9px;color:var(--red);letter-spacing:.1em;margin-bottom:6px">✕ ロック中</div>
        <div style="display:flex;flex-wrap:wrap;gap:5px">
          ${locked.map(u=>`<span class="access-chip" style="background:var(--red-dim);color:var(--red);border:1px solid #ff525244">${u.page} (LV${u.requiredLevel})</span>`).join('')}
        </div>
      </div>`:''}
    </div>
  </div>`,

  // ── 3. メッセージプレビュー ──
  `<div class="pv-card">
    <div class="pv-card-head">
      <div class="pv-card-icon">▸</div>
      <div class="pv-card-title">表示メッセージプレビュー</div>
    </div>
    <div class="pv-card-body">
      ${[
        ['ウェルカム', msgs.welcomeMessages?.[lv]],
        ['ダッシュボード', msgs.dashboardMessages?.[lv]],
        ['ステータス', msgs.statusMessages?.[lv]],
        ['デイリーログイン', msgs.dailyLoginMessages?.[lv]],
      ].map(([label, m]) => m ? `
        <div class="msg-preview">
          <div class="msg-key">// ${label}</div>
          ${Object.entries(m).map(([k,v])=>`<div style="margin-bottom:4px"><span style="font-family:var(--mono);font-size:9px;color:var(--text3)">${k}: </span><span class="msg-val">${v}</span></div>`).join('')}
        </div>` : '').join('')}
      <div style="margin-top:8px">
        <div style="font-family:var(--mono);font-size:9px;color:var(--text3);margin-bottom:6px">// ヒントメッセージ一覧</div>
        ${(msgs.hintMessages?.[lv]||[]).map(h=>`<div style="padding:4px 0;border-bottom:1px solid var(--border);font-size:12px;color:var(--text2)">・${h}</div>`).join('')}
      </div>
    </div>
  </div>`,

  // ── 4. ストーリー状態 ──
  `<div class="pv-card">
    <div class="pv-card-head">
      <div class="pv-card-icon">▸</div>
      <div class="pv-card-title">ストーリー / ARG状態</div>
      <div class="pv-card-status" style="background:${state.anomaly>=50?'var(--red-dim)':state.anomaly>=20?'#281400':'var(--panel2)'};color:${state.anomaly>=50?'var(--red)':state.anomaly>=20?'var(--orange)':'var(--text3)'};border:1px solid ${state.anomaly>=50?'var(--red)':state.anomaly>=20?'var(--orange)':'var(--border2)'}">anomaly:${state.anomaly}</div>
    </div>
    <div class="pv-card-body">
      <div style="margin-bottom:12px">
        <div style="font-family:var(--mono);font-size:9px;color:var(--text3);margin-bottom:8px">// アクティブフェーズ</div>
        <div class="phase-indicator">
          ${activePhase.length ? activePhase.map(p=>`<span class="phase-chip" style="background:${p.color}18;color:${p.color};border-color:${p.color}44">${p.label}</span>`).join('') : '<span style="font-family:var(--mono);font-size:10px;color:var(--text3)">— 通常状態 —</span>'}
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div style="background:var(--panel2);padding:10px;border:1px solid var(--border)">
          <div style="font-family:var(--mono);font-size:9px;color:var(--text3);margin-bottom:4px">ANOMALY SCORE</div>
          <div style="font-family:var(--mono);font-size:20px;color:${state.anomaly>=50?'var(--red)':state.anomaly>=20?'var(--orange)':'var(--yellow)'}">${state.anomaly}</div>
          <div style="height:4px;background:var(--border2);margin-top:6px"><div style="height:100%;width:${(state.anomaly/60)*100}%;background:${state.anomaly>=50?'var(--red)':state.anomaly>=20?'var(--orange)':'var(--yellow)'}"></div></div>
        </div>
        <div style="background:var(--panel2);padding:10px;border:1px solid var(--border)">
          <div style="font-family:var(--mono);font-size:9px;color:var(--text3);margin-bottom:4px">OBSERVER LOAD</div>
          <div style="font-family:var(--mono);font-size:20px;color:${state.observer>=80?'var(--red)':state.observer>=50?'var(--orange)':'var(--cyan)'}">${state.observer}</div>
          <div style="height:4px;background:var(--border2);margin-top:6px"><div style="height:100%;width:${state.observer}%;background:${state.observer>=80?'var(--red)':state.observer>=50?'var(--orange)':'var(--cyan)'}"></div></div>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;flex-wrap:wrap;gap:6px">
        ${STORY_FLAGS.map(f=>`<span style="font-family:var(--mono);font-size:10px;padding:3px 8px;border-radius:2px;background:${state.flags[f]?'var(--green-dim)':'var(--panel2)'};color:${state.flags[f]?'var(--green)':'var(--text3)'};border:1px solid ${state.flags[f]?'var(--green)':'var(--border)'}">${f}</span>`).join('')}
      </div>
    </div>
  </div>`,

  // ── 5. XP報酬シミュレーション ──
  `<div class="pv-card">
    <div class="pv-card-head">
      <div class="pv-card-icon">▸</div>
      <div class="pv-card-title">XP報酬テーブル (現在の設定)</div>
    </div>
    <div class="pv-card-body">
      <table class="access-table">
        <thead><tr><th>アクション</th><th>XP</th><th>次レベルまで</th></tr></thead>
        <tbody>
          ${Object.entries(CONFIG.xpRewards).map(([k,v])=>{
            const remaining = nextXp ? Math.max(0,nextXp-xp) : 0;
            const times = remaining>0&&v>0 ? Math.ceil(remaining/v)+'回' : '—';
            return `<tr><td>${k}</td><td style="font-family:var(--mono);color:var(--green)">+${v}</td><td style="font-family:var(--mono);font-size:10px;color:var(--text3)">${times}</td></tr>`;
          }).join('')}
        </tbody>
      </table>
    </div>
  </div>`,

  ].join('');
}

// Init
renderFlagList();
render();
</script>
</body>
</html>